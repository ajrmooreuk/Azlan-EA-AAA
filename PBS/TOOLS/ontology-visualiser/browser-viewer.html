<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OAA Ontology Visualiser</title>
<script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
<link rel="stylesheet" href="css/viewer.css">
</head>
<body>

<header>
  <h1>OAA Ontology Visualiser</h1>
  <span id="file-name" style="font-size:13px; color:#666;"></span>
  <span id="compliance-status" style="display:none;" class="compliance-badge" onclick="toggleAudit()" title="Click to view OAA v6.1.0 compliance report">
    <span class="dot"></span>
    <span id="compliance-text">OAA v6.1.0</span>
  </span>
  <span class="stats" id="stats"></span>
</header>

<div class="toolbar">
  <label for="file-input">Open JSON File</label>
  <input type="file" id="file-input" accept=".json,.jsonld">
  <button id="btn-physics" class="active" onclick="togglePhysics()">Physics</button>
  <select id="layout-select" onchange="changeLayout()">
    <option value="physics">Force-directed</option>
    <option value="hierarchical">Hierarchical</option>
    <option value="circular">Circular</option>
  </select>
  <button onclick="fitGraph()">Fit View</button>
  <button onclick="resetGraph()">Reset</button>
  <button onclick="exportPNG()">Export PNG</button>
  <button id="btn-sidebar" onclick="toggleSidebar()">Details</button>
  <button id="btn-audit" onclick="toggleAudit()">OAA Audit</button>
  <button id="btn-run-oaa" onclick="runOAAUpgrade()" style="display:none;" title="Generate Claude Code command to upgrade this ontology">Upgrade with OAA v6</button>
  <button id="btn-save-library" onclick="showSaveToLibrary()" style="display:none;" title="Save compliant ontology to library">Save to Library</button>
  <button id="btn-export-audit" onclick="exportAuditFile()" style="display:none;" title="Download audit results as JSON">Export Audit</button>
  <span style="border-left:1px solid #3a3d47; height:24px;"></span>
  <button onclick="toggleLibrary()">&#x1F4DA; Library</button>
  <button onclick="loadFromGitHub()">Load from GitHub</button>
  <button onclick="loadRegistry()" title="Load all ontologies from unified registry into a merged graph">Load Registry</button>
  <button onclick="loadTestDataFile()">+ Test Data</button>
</div>

<div class="breadcrumb-bar" id="breadcrumb" style="display:none;">
  <button class="breadcrumb-home" onclick="navigateToTier0()" title="Return to series overview">&#x2302; Home</button>
  <span id="breadcrumb-path"></span>
  <div id="tier0-toggle" style="display:none;">
    <button class="tier-toggle active" data-view="series" onclick="navigateToTier0()">Series (6)</button>
    <button class="tier-toggle" data-view="ontologies" onclick="showAllOntologies()">Ontologies (23)</button>
    <button class="tier-toggle" data-view="connections" onclick="showConnectionMap()" title="Show ontology-to-ontology dependency graph">Connections</button>
  </div>
  <div id="lineage-toggle" style="display:none; margin-left:8px;">
    <button class="lineage-toggle" data-lineage="VE" onclick="toggleLineage('VE')" title="Highlight VE lineage chain (VSOM→OKR→VP→PMF→EFS)">
      <span class="lineage-dot ve"></span> VE Chain
    </button>
    <button class="lineage-toggle" data-lineage="PE" onclick="toggleLineage('PE')" title="Highlight PE lineage chain (PPM→PE→EFS→EA)">
      <span class="lineage-dot pe"></span> PE Chain
    </button>
    <button class="lineage-toggle" data-lineage="both" onclick="toggleLineage('both')" title="Show both lineage chains with EFS convergence">Both</button>
  </div>
  <div id="cross-edge-filter" style="display:none; margin-left:4px;">
    <button id="btn-cross-edge-filter" class="cross-edge-filter-btn" onclick="toggleCrossEdgeFilter()" title="Show only cross-ontology edges">
      Cross-refs Only
    </button>
  </div>
  <div id="bridge-filter" style="display:none; margin-left:auto;">
    <button id="btn-bridge-filter" class="bridge-filter-btn" onclick="toggleBridgeFilter()" title="Show only bridge nodes (referenced by 3+ ontologies)">
      &#x1F309; Bridges (<span id="bridge-count">0</span>)
    </button>
  </div>
</div>

<div id="graph-container">
  <div id="drop-zone">
    <div class="drop-area" id="drop-area">
      <h2>Drop JSON Ontology Here</h2>
      <p>or click "Open JSON File" above</p>
      <div class="formats">Supports: OAA v6.1.0 (hasDefinedTerm), JSON-LD, UniRegistry, Registry Entry, Agent Registry<br>Validates against OAA v6.1.0 compliance gates (G1-G6)<br>Use "Load from GitHub" to fetch from a private repo, or "Load Registry" for the full unified registry</div>
    </div>
  </div>
  <div id="network"></div>
  <div class="sidebar" id="sidebar">
    <button class="close-btn" onclick="toggleSidebar()">&times;</button>
    <h3 id="sidebar-title">Node Details</h3>
    <div class="sidebar-tabs" id="sidebar-tabs">
      <button class="sidebar-tab active" onclick="switchTab('details')">Details</button>
      <button class="sidebar-tab" onclick="switchTab('connections')">Connections</button>
      <button class="sidebar-tab" onclick="switchTab('schema')">Schema</button>
      <button class="sidebar-tab" onclick="switchTab('data')">Data</button>
    </div>
    <div id="tab-details" class="tab-content"><p style="color:#666">Click a node to see details</p></div>
    <div id="tab-connections" class="tab-content" style="display:none;"></div>
    <div id="tab-schema" class="tab-content" style="display:none;"></div>
    <div id="tab-data" class="tab-content" style="display:none;"></div>
  </div>
  <div class="legend" id="legend" style="display:none;"></div>
  <div class="audit-panel" id="audit-panel">
    <button class="close-btn" onclick="toggleAudit()">&times;</button>
    <h3>OAA v6.1.0 Compliance</h3>
    <div id="oaa-compliance-content"><p style="color:#666">Load a graph to see compliance report</p></div>
    <h3 style="margin-top:16px;">Graph Audit</h3>
    <div id="audit-content"><p style="color:#666">Load a graph to see audit results</p></div>
  </div>
</div>

<!-- OAA Upgrade Modal -->
<div id="oaa-modal" class="oaa-modal" style="display:none;">
  <div class="oaa-modal-content">
    <button class="close-btn" onclick="closeOAAModal()">&times;</button>
    <h3>Run OAA v6.1.0 Upgrade</h3>
    <div id="oaa-modal-body"></div>
  </div>
</div>

<!-- Save to Library Modal -->
<div id="save-library-modal" class="oaa-modal" style="display:none;">
  <div class="oaa-modal-content" style="max-width:500px;">
    <button class="close-btn" onclick="closeSaveLibraryModal()">&times;</button>
    <h3>Save to Ontology Library</h3>
    <div id="save-library-body"></div>
  </div>
</div>

<!-- Ontology Library Panel -->
<div class="library-panel" id="library-panel">
  <button class="close-btn" onclick="toggleLibrary()">&times;</button>
  <h3>&#x1F4DA; Ontology Library</h3>
  <div style="margin-bottom:12px; display:flex; gap:8px;">
    <button class="oaa-btn oaa-btn-secondary" onclick="exportLibrary()" style="font-size:11px; padding:6px 10px;">Export</button>
    <button class="oaa-btn oaa-btn-secondary" onclick="importLibrary()" style="font-size:11px; padding:6px 10px;">Import</button>
  </div>
  <div id="library-content"><p class="library-empty">Loading library...</p></div>
</div>

<script type="module" src="js/app.js"></script>
</body>
</html>
